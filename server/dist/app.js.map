{"version":3,"file":"app.js","names":["dotenv","config","app","express","use","bodyParser","urlencoded","extended","json","nunjucks","configure","autoescape","set","path","join","process","cwd","passportConfig","corsOptions","cors","globalRouter","get","req","res","next","err","Error","ip","originalUrl","statusCode","post","authController","login","teamController","getTeam","client","AwesomeGraphQLClient","endpoint","settings","GRAPHCMS_CONTENT_API","fetch","fetchOptions","headers","Authorization","GRAPHCMS_ACCESS_TOKEN","request","body","query","variables","error","status","url","message","accepts","render","send","PORT","env","NODE_ENV","listen","console","log"],"sources":["../src/app.js"],"sourcesContent":["import path from 'path';\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport nunjucks from 'nunjucks';\nimport dotenv from 'dotenv';\nimport cors from 'cors';\n \nimport passportConfig from './config/passport';\nimport globalRouter from './routes';\n\nimport 'core-js/stable';\nimport 'regenerator-runtime/runtime';\nimport authController from './api/controllers/auth.controller.js';\nimport teamController from './api/controllers/team.controller.js';\nimport { AwesomeGraphQLClient } from 'awesome-graphql-client';\nimport settings from './config/settings';\nimport fetch from 'node-fetch';\n\n// Read .env settings\ndotenv.config();\n\n/*\nFast, unopinionated, minimalist web framework for node.\nhttps://www.npmjs.com/package/express\n\nInitalize the express application\n*/\nconst app = express();\n\n/*\nNode.js body parsing middleware\n\nParse incoming request bodies in a middleware before your handlers, available under the req.body property.\nhttps://www.npmjs.com/package/body-parser\n*/\n\n// Parse application/x-www-form-urlencoded\napp.use(bodyParser.urlencoded({ \n  extended: false \n}));\n// Parse application/json\napp.use(bodyParser.json());\n// Set default view engine\nnunjucks.configure('views', {\n  autoescape: true,\n  express: app\n});\napp.set('view engine', 'html');\n// Serve static content\napp.use(express.static(path.join(process.cwd(), '..', 'client', 'build')));\n\n/*\nPassport\n*/\npassportConfig(app);\n\n/*\nCors parsing middleware\n\ncors is a node.js package for providing a Connect/Express middleware that can be used to enable CORS with various options.\nhttps://www.npmjs.com/package/cors\n*/\nconst corsOptions = {\n}\napp.use(cors(corsOptions));\n\n/*\nAdd all routers to Express app\n\nAll routes (paths) are registered\n*/\napp.use('/', globalRouter);\n\n/*\n\nNot Found routes\n*/\napp.get('*', (req, res, next) => {\n  const err = new Error(\n    `${req.ip} tried to access ${req.originalUrl}`,\n  );\n  err.statusCode = 301;\n  next(err);\n});\n\n/*\nLogin Route\n*/\napp.post('/api/login', authController.login);\napp.get('/api/getTeam', teamController.getTeam)\n\napp.post('/graphql', async(req, res, next) => {\n\n  const client = new AwesomeGraphQLClient({\n        endpoint: `${settings.GRAPHCMS_CONTENT_API}`,\n        fetch,\n        fetchOptions: {\n            headers: {\n                Authorization: `Bearer ${settings.GRAPHCMS_ACCESS_TOKEN}`,\n            },\n        },\n    });\n    const query = await client.request(req.body.query, req.body.variables);\n    return res.json({\n      \"data\": {\n        ...query\n      }\n    })\n})\n/* \nFetch Team\n*/\n\n/*\nNot Found routes\n*/\napp.get('*', (req, res, next) => {\n  const err = new Error(\n    `${req.ip} tried to access ${req.originalUrl}`,\n  );\n  err.statusCode = 301;\n  next(err);\n});\n\n/*\nError Handler\n*/\napp.use((err, req, res, next) => {\n  const error = err;\n  error.statusCode = error.statusCode || 500;\n  res.status(error.statusCode);\n\n  const body = {\n    url: req.url,\n    error: {\n      message: error.message,\n      statusCode: error.statusCode,\n    },\n  };\n\n  if (req.accepts('html')) {  \n    res.render('error', body);\n  } else if (req.accepts('json')) {\n    res.json(body);\n  } else {\n    res.send('You have to accept application/json or text/html!');\n  }\n  next();\n});\n\n\n// Set the port used by the server\nconst PORT = process.env.PORT || 8080;\n\n// Set the Node environment\nconst NODE_ENV = process.env.NODE_ENV || 'development';\n\n// Express js listen method to run project on http://localhost:3000\napp.listen(PORT, () => {\n  console.log(`Application is running in ${NODE_ENV} mode on port ${PORT}`);\n});\n"],"mappings":"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"}