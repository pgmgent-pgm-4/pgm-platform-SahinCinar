{"version":3,"file":"auth.controller.js","names":["login","req","res","next","passport","authenticate","err","user","info","userPayload","id","username","email","token","jwt","sign","settings","JWT_SECRET","expiresIn","JWT_EXPIRE","authenticated","status","json","console","log","handleHTTPError","logout","session","destroy","error"],"sources":["../../../src/api/controllers/auth.controller.js"],"sourcesContent":["import passport from 'passport';\nimport jwt from 'jsonwebtoken';\n\nimport settings from '../../config/settings';\nimport { handleHTTPError, HTTPError } from '../../utils';\n\nconst login = (req, res, next) => {\n  passport.authenticate('login', async (err, user, info) => {\n    try {\n      if (err || !user) {\n        throw err;\n      }\n\n      const userPayload = {\n        id: user.id,\n        username: user.username,\n        email: user.email,\n      };\n\n      const token = jwt.sign({ user: userPayload }, settings.JWT_SECRET, {\n        expiresIn: settings.JWT_EXPIRE,\n      });\n\n      const authenticated = {\n        ...userPayload,\n        token,\n      };\n\n      return res.status(200).json(authenticated);\n    } catch (error) {\n      console.log(error);\n      return handleHTTPError(error, next);\n    }\n  })(req, res, next);\n};\n\nconst logout = (req, res, next) => {\n  try {\n    req.logout();\n    req.session.destroy((err) => {\n      if (err) {\n        return next(err);\n      }\n\n      // destroy session data\n      req.session = null;\n    });\n  } catch (error) {\n    handleHTTPError(error, next);\n  }\n};\n\nexport default {\n  login,\n  logout,\n};\n"],"mappings":";;;;;;;;;;;;;;;AAAA;;AACA;;AAEA;;AACA;;;;;;AAEA,IAAMA,KAAK,GAAG,SAARA,KAAQ,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;EAChCC,oBAAA,CAASC,YAAT,CAAsB,OAAtB;IAAA,yFAA+B,iBAAOC,GAAP,EAAYC,IAAZ,EAAkBC,IAAlB;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;;cAAA,MAEvBF,GAAG,IAAI,CAACC,IAFe;gBAAA;gBAAA;cAAA;;cAAA,MAGnBD,GAHmB;;YAAA;cAMrBG,WANqB,GAMP;gBAClBC,EAAE,EAAEH,IAAI,CAACG,EADS;gBAElBC,QAAQ,EAAEJ,IAAI,CAACI,QAFG;gBAGlBC,KAAK,EAAEL,IAAI,CAACK;cAHM,CANO;cAYrBC,KAZqB,GAYbC,wBAAA,CAAIC,IAAJ,CAAS;gBAAER,IAAI,EAAEE;cAAR,CAAT,EAAgCO,oBAAA,CAASC,UAAzC,EAAqD;gBACjEC,SAAS,EAAEF,oBAAA,CAASG;cAD6C,CAArD,CAZa;cAgBrBC,aAhBqB,mCAiBtBX,WAjBsB;gBAkBzBI,KAAK,EAALA;cAlByB;cAAA,iCAqBpBX,GAAG,CAACmB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,aAArB,CArBoB;;YAAA;cAAA;cAAA;cAuB3BG,OAAO,CAACC,GAAR;cAvB2B,iCAwBpB,IAAAC,sBAAA,eAAuBtB,IAAvB,CAxBoB;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAA/B;;IAAA;MAAA;IAAA;EAAA,KA0BGF,GA1BH,EA0BQC,GA1BR,EA0BaC,IA1Bb;AA2BD,CA5BD;;AA8BA,IAAMuB,MAAM,GAAG,SAATA,MAAS,CAACzB,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;EACjC,IAAI;IACFF,GAAG,CAACyB,MAAJ;IACAzB,GAAG,CAAC0B,OAAJ,CAAYC,OAAZ,CAAoB,UAACtB,GAAD,EAAS;MAC3B,IAAIA,GAAJ,EAAS;QACP,OAAOH,IAAI,CAACG,GAAD,CAAX;MACD,CAH0B,CAK3B;;;MACAL,GAAG,CAAC0B,OAAJ,GAAc,IAAd;IACD,CAPD;EAQD,CAVD,CAUE,OAAOE,KAAP,EAAc;IACd,IAAAJ,sBAAA,EAAgBI,KAAhB,EAAuB1B,IAAvB;EACD;AACF,CAdD;;eAgBe;EACbH,KAAK,EAALA,KADa;EAEb0B,MAAM,EAANA;AAFa,C"}